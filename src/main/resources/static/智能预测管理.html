<!DOCTYPE html>
<html lang="zh-CN">
<head>
<style>
/* 立即隐藏CMDB菜单项 - 防止闪烁 */
.nav-cmdb { display: none !important; }
.sidebar-item[data-page="CMDB"] { display: none !important; }
</style>
<script>
// 立即执行：尽早隐藏CMDB，防止闪烁
(function() {
    function hideCMDB() {
        var items = document.querySelectorAll('.sidebar-item');
        items.forEach(function(item) {
            var span = item.querySelector('span');
            if (span && span.textContent.trim() === 'CMDB') {
                item.style.display = 'none';
                item.setAttribute('data-hidden', 'true');
            }
        });
    }
    
    hideCMDB();
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideCMDB);
    }
    
    setTimeout(hideCMDB, 10);
    setTimeout(hideCMDB, 100);
})();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能预测管理 - 人工智能运维平台</title>
    <link rel="stylesheet" href="libs/fontawesome/6.0.0/css/all.min.css">
    <!-- jQuery库 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="chart.js"></script>

    <!-- 预测数据展示相关脚本 -->
    <script src="js/prediction-time-filter.js"></script>
    <!-- <script src="js/prediction-report-data.js"></script> --> <!-- 已废弃，使用新版 -->
    <!-- prediction-risk.js moved to bottom with other page scripts -->
    <script src="js/prediction-analysis-data.js"></script>

    <link rel="stylesheet" href="智能预测管理.css">
    <link rel="stylesheet" href="智能预测管理-model-service.css">
    <style>
        /* 子页面样式 */
        .sub-page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .sub-page.active {
            display: block;
            height: calc(100vh - 180px); /* 减去头部导航和工具栏高度 */
            /* 不在这里添加滚动条，避免与内层滚动条重复 */
        }
        
        /* 特殊处理：非智能统计页面需要滚动条 */
        .sub-page.active:not(#page-stats) {
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        /* 智能统计页面容器不显示滚动条 */
        #page-stats.sub-page.active {
            overflow: hidden;
            padding: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 子菜单样式 */
        .sub-nodes {
            display: none;
            padding-left: 30px;
            margin-top: 5px;
        }

        .tree-node.expanded > .sub-nodes {
            display: block;
        }

        .expand-icon {
            transition: transform 0.3s;
            margin-right: 5px;
            font-size: 12px;
        }

        .tree-node.expanded > .node-item > .expand-icon {
            transform: rotate(90deg);
        }

        .sub-node {
            font-size: 13px;
            padding: 8px 12px;
            margin: 3px 0;
        }

        .sub-node:hover {
            background: #f0f0f0;
        }

        .sub-node.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* 智能统计子页面样式 */
        .stats-sub-page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .stats-sub-page.active {
            display: block;
            height: calc(100vh - 180px); /* 减去头部导航和工具栏高度 */
            overflow-y: auto; /* 添加垂直滚动条 */
            padding: 20px;
            box-sizing: border-box; /* 确保padding包含在高度内 */
        }

        /* 美化滚动条样式 - 只作用于实际需要滚动的容器 */
        .sub-page.active:not(#page-stats)::-webkit-scrollbar,
        .stats-sub-page.active::-webkit-scrollbar {
            width: 8px;
        }

        .sub-page.active:not(#page-stats)::-webkit-scrollbar-track,
        .stats-sub-page.active::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .sub-page.active:not(#page-stats)::-webkit-scrollbar-thumb,
        .stats-sub-page.active::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: background 0.3s;
        }

        .sub-page.active:not(#page-stats)::-webkit-scrollbar-thumb:hover,
        .stats-sub-page.active::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .page-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .page-header-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            flex-shrink: 0;
        }

        .page-header-info h3 {
            font-size: 20px;
            color: #1f2937;
            margin: 0 0 4px 0;
            font-weight: 600;
        }

        .page-header-info p {
            color: #6b7280;
            margin: 0;
            font-size: 13px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
        }

        .table-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .table-header-left h4 {
            margin: 0;
            color: #1f2937;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-header-left h4 i {
            color: #667eea;
            font-size: 18px;
        }

        .table-count {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .btn-export {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.warning {
            background: #fed7aa;
            color: #92400e;
        }

        /* 增强统计卡片样式 */
        .stats-grid .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stats-grid .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(102,126,234,0.08) 0%, rgba(118,75,162,0.08) 100%);
            border-radius: 0 12px 0 100%;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        /* 为不同卡片的图标设置不同的渐变色 */
        .stats-grid .stat-card:nth-child(1) .stat-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .stats-grid .stat-card:nth-child(2) .stat-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(240,147,251,0.3);
        }

        .stats-grid .stat-card:nth-child(3) .stat-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79,172,254,0.3);
        }

        .stats-grid .stat-card:nth-child(4) .stat-icon {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(67,233,123,0.3);
        }

        .stat-title {
            position: relative;
            z-index: 1;
        }

        .stat-value {
            position: relative;
            z-index: 1;
        }

        .stat-trend {
            position: relative;
            z-index: 1;
        }

        .stat-trend.up {
            color: #10b981;
        }

        .stat-trend.down {
            color: #ef4444;
        }

        /* 图表容器增强 */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title i {
            font-size: 18px;
            color: #667eea;
        }

        /* 统计概览页面专用样式 - 现代化美化版本 */
        .overview-top-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .overview-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.08), 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid rgba(102, 126, 234, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15), 0 2px 6px rgba(0,0,0,0.08);
        }

        .overview-card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.08);
            position: relative;
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .card-header h4 {
            margin: 0;
            font-size: 16px;
            color: #1a1a1a;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .view-details, .view-more {
            font-size: 13px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            padding-right: 4px;
        }

        .view-details:hover, .view-more:hover {
            color: #764ba2;
            transform: translateX(4px);
        }

        /* 训练详情模态框样式 */
        .training-details-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
        }

        .details-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-bottom: none;
        }

        .details-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .details-content {
            padding: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-item label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item span {
            font-size: 14px;
            color: #333;
            font-weight: 600;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .training-history-timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline-item {
            position: relative;
            padding: 16px 0;
            border-left: 2px solid #e9ecef;
            padding-left: 24px;
            margin-bottom: 16px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #667eea;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px #667eea;
        }

        .timeline-item.success::before {
            background: #28a745;
            box-shadow: 0 0 0 2px #28a745;
        }

        .timeline-item.failed::before {
            background: #dc3545;
            box-shadow: 0 0 0 2px #dc3545;
        }

        .timeline-content {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .timeline-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 14px;
        }

        .timeline-status.success {
            color: #28a745;
        }

        .timeline-status.failed {
            color: #dc3545;
        }

        .timeline-status.running {
            color: #ffc107;
        }

        .timeline-time {
            font-size: 12px;
            color: #666;
        }

        .timeline-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .timeline-detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .timeline-detail-item label {
            font-size: 11px;
            color: #666;
            font-weight: 500;
        }

        .timeline-detail-item span {
            font-size: 13px;
            color: #333;
            font-weight: 600;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #666;
        }

        .small-select {
            padding: 4px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
        }

        .smart-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
            margin-top: 18px;
        }

        .smart-stat-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.03) 0%, rgba(118, 75, 162, 0.05) 100%);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .smart-stat-item:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.12);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.04em;
            animation: countUp 0.6s ease-out;
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .stat-sublabel {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            font-weight: 500;
        }

        .device-fault-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            border-radius: 8px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .device-fault-info .device-count {
            font-size: 14px;
            color: #666;
        }
        
        .device-fault-info .device-count strong {
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
            margin-left: 4px;
        }
        
        .device-fault-info .fault-rate {
            font-size: 14px;
            color: #666;
        }
        
        .device-fault-info .fault-rate strong {
            font-size: 18px;
            font-weight: 600;
            margin-left: 4px;
        }

        .donut-chart-container {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .donut-chart {
            flex-shrink: 0;
        }

        .chart-legend {
            flex: 1;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-text {
            color: #666;
        }

        .legend-value {
            color: #1a1a1a;
            font-weight: 600;
        }

        .alert-number {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin: 20px 0;
            letter-spacing: -0.04em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .mini-chart-container {
            height: 100px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(239, 68, 68, 0.08) 100%);
            border-radius: 12px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed rgba(245, 158, 11, 0.2);
        }

        .mini-chart-placeholder i {
            font-size: 40px;
            color: rgba(245, 158, 11, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .alert-indicators {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .alert-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .alert-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .alert-badge.critical {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 1px solid rgba(153, 27, 27, 0.2);
        }

        .alert-badge.warning {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            color: #92400e;
            border: 1px solid rgba(146, 64, 14, 0.2);
        }

        .alert-badge.info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 1px solid rgba(30, 64, 175, 0.2);
        }

        .no-data-placeholder {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        .no-data-placeholder i {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.3;
        }

        .no-data-placeholder p {
            margin: 0;
            font-size: 13px;
        }

        .device-status-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.08), 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid rgba(102, 126, 234, 0.08);
            animation: fadeInUp 0.7s ease-out;
            transition: all 0.4s ease;
        }

        .device-status-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.12), 0 2px 6px rgba(0,0,0,0.08);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.08);
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .section-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .device-status-list {
            display: flex;
            gap: 40px;
            justify-content: center;
        }

        .device-status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .device-status-item:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: translateY(-4px);
        }

        .status-icon-circle {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #14b8a6;
            box-shadow: 0 4px 16px rgba(20, 184, 166, 0.2);
            transition: all 0.3s ease;
        }

        .device-status-item:hover .status-icon-circle {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 24px rgba(20, 184, 166, 0.3);
        }

        .stats-section-title {
            font-size: 14px;
            color: #666;
            margin: 16px 0 12px 0;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .status-text {
            font-size: 12px;
            color: #10b981;
            font-weight: 600;
        }

        .device-label {
            font-size: 13px;
            color: #666;
        }

        .device-detail-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            animation: fadeInUp 0.8s ease-out;
        }

        .device-detail-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.08), 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid rgba(102, 126, 234, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .device-detail-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .device-detail-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15), 0 2px 6px rgba(0,0,0,0.08);
        }

        .device-detail-card:hover::before {
            opacity: 1;
        }

        .detail-card-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.08);
            position: relative;
        }

        .detail-card-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .detail-card-header h5 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .detail-stats-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .detail-stat-item {
            flex: 1;
            min-width: 100px;
            text-align: center;
            padding: 14px 8px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.03) 0%, rgba(5, 150, 105, 0.05) 100%);
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
        }

        .detail-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        .detail-stat-item.status-normal {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(6, 95, 70, 0.2);
        }

        .detail-stat-item .stat-value {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .detail-stat-item .stat-desc {
            font-size: 11px;
            color: #666;
            line-height: 1.4;
            font-weight: 500;
        }

        .detail-charts-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }

        .detail-mini-chart {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.03) 0%, rgba(5, 150, 105, 0.05) 100%);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
        }

        .detail-mini-chart:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.12);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(5, 150, 105, 0.1) 100%);
        }

        .detail-mini-chart .chart-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .detail-mini-chart .chart-number {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .filter-select {
            min-width: 150px;
        }

        .filter-input {
            min-width: 200px;
        }

        .filter-select:focus, .filter-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn-new {
            padding: 10px 20px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-left: auto;
        }

        .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        /* 数据表格 */
        .data-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f8f9fa;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            font-size: 14px;
            border-bottom: 2px solid #e9ecef;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #666;
        }

        .data-table tbody tr {
            transition: all 0.3s;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* 状态标签 */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.active {
            background: #d4edda;
            color: #28a745;
        }

        .status-badge.active::before {
            content: '●';
            margin-right: 5px;
        }

        .status-badge.status-success {
            background: #d4edda;
            color: #28a745;
        }

        .status-badge.status-error {
            background: #f8d7da;
            color: #dc3545;
        }

        .status-badge.status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.status-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* 操作按钮 */
        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-action.enable {
            background: #3498db;
            color: white;
        }

        .btn-action.enable:hover {
            background: #2980b9;
        }

        .btn-action.edit {
            background: #f39c12;
            color: white;
        }

        .btn-action.edit:hover {
            background: #e67e22;
        }

        .btn-action.delete {
            background: #e74c3c;
            color: white;
        }

        .btn-action.delete:hover {
            background: #c0392b;
        }

        .btn-action.config {
            background: #9b59b6;
            color: white;
        }

        .btn-action.config:hover {
            background: #8e44ad;
        }

        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(102,126,234,0.2);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-title {
            font-size: 14px;
            color: #999;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-trend {
            font-size: 13px;
            color: #28a745;
        }

        /* 图表容器 */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        /* 分页 */
        .pagination {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-top: 1px solid #f0f0f0;
        }

        .pagination-info {
            color: #666;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn:hover {
            border-color: #3498db;
            color: #3498db;
        }

        .page-input {
            width: 50px;
            padding: 6px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* 预测报告页面样式 */
        .report-layout {
            display: flex;
            height: 100%;
            background: white;
        }

        .report-sidebar {
            width: 200px;
            background: #fafafa;
            border-right: 1px solid #e4e7ed;
            padding: 10px 0;
            overflow-y: auto;
        }

        .sidebar-category {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #606266;
            transition: all 0.3s;
        }

        .sidebar-category:hover {
            background: #f0f2f5;
            color: #409eff;
        }

        .sidebar-category.active {
            background: #ecf5ff;
            color: #409eff;
            font-weight: 600;
        }

        .category-text {
            flex: 1;
        }

        .category-count {
            color: #909399;
            font-size: 12px;
        }

        .report-main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .report-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 4px;
        }

        .toolbar-left, .toolbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toolbar-select {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .time-input {
            width: 60px;
            padding: 6px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            text-align: center;
        }

        .btn-close-toolbar {
            width: 28px;
            height: 28px;
            border: none;
            background: #f5f7fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            color: #909399;
            transition: all 0.3s;
        }

        .btn-close-toolbar:hover {
            background: #e4e7ed;
            color: #606266;
        }

        .status-toggle-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-btn {
            padding: 8px 24px;
            border: 1px solid #dcdfe6;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #606266;
            transition: all 0.3s;
        }

        .status-btn:hover {
            border-color: #409eff;
            color: #409eff;
        }

        .status-btn.active {
            background: #409eff;
            border-color: #409eff;
            color: white;
        }

        .report-chart-container {
            height: 400px;
            background: white;
            border: 1px solid #e4e7ed;
            border-radius: 4px;
            padding: 20px;
        }

        /* 预训风险页面样式 */
        .risk-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e4e7ed;
            margin-bottom: 20px;
        }

        .toolbar-filters {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-item label {
            font-size: 14px;
            color: #606266;
            white-space: nowrap;
        }

        .filter-select {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
        }

        .search-input {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            width: 200px;
            font-size: 14px;
        }

        .btn-search {
            padding: 8px 20px;
            border: none;
            background: #409eff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-search:hover {
            background: #66b1ff;
        }

        .btn-history {
            padding: 8px 20px;
            border: 1px solid #409eff;
            background: white;
            color: #409eff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-history:hover {
            background: #ecf5ff;
        }

        .risk-table-container {
            background: white;
            border-radius: 4px;
            overflow: hidden;
        }

        .risk-table {
            width: 100%;
            border-collapse: collapse;
        }

        .risk-table thead {
            background: #f5f7fa;
        }

        .risk-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #606266;
            border-bottom: 1px solid #e4e7ed;
        }

        .risk-table td {
            padding: 12px 16px;
            font-size: 14px;
            color: #606266;
            border-bottom: 1px solid #f0f2f5;
        }

        .risk-table tbody tr:hover {
            background: #f5f7fa;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state i {
            font-size: 64px;
            color: #dcdfe6;
            margin-bottom: 16px;
        }

        .empty-state p {
            font-size: 14px;
            color: #909399;
            margin: 0;
        }

        /* 智能分析页面样式 */
        .analysis-layout {
            display: flex;
            height: 100%;
            background: white;
        }

        .analysis-main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .analysis-chart-container {
            height: 300px;
            background: white;
            border: 1px solid #e4e7ed;
            border-radius: 4px;
            margin-bottom: 20px;
            padding: 20px;
        }

        .time-range-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .time-range-input {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            width: 200px;
        }

        .time-value-input {
            width: 80px;
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            text-align: center;
        }

        .btn-query {
            padding: 8px 24px;
            border: none;
            background: #409eff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-query:hover {
            background: #66b1ff;
        }

        .analysis-table-container {
            background: white;
            border-radius: 4px;
            overflow-x: auto;
        }

        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .analysis-table thead {
            background: #f5f7fa;
        }

        .analysis-table th {
            padding: 12px 10px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #606266;
            border-bottom: 1px solid #e4e7ed;
            white-space: nowrap;
        }

        .analysis-table td {
            padding: 12px 10px;
            font-size: 13px;
            color: #606266;
            border-bottom: 1px solid #f0f2f5;
        }

        .analysis-sidebar {
            width: 250px;
            background: #fafafa;
            border-left: 1px solid #e4e7ed;
            padding: 20px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #606266;
            margin-bottom: 12px;
        }

        .sidebar-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
        }

        .section-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .section-item:hover {
            background: #ecf5ff;
            color: #409eff;
        }

        .section-item i {
            font-size: 16px;
        }

        /* 算法模型服务页面样式 */
        .model-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e4e7ed;
            margin-bottom: 20px;
        }

        .toolbar-left-filters {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .model-input, .model-search {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
        }

        .model-input {
            width: 150px;
        }

        .model-search {
            width: 180px;
        }

        .model-select {
            padding: 6px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            min-width: 140px;
        }

        .btn-model-search {
            width: 36px;
            height: 32px;
            border: none;
            background: #409eff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-model-search:hover {
            background: #66b1ff;
        }

        .btn-model-reset {
            padding: 6px 16px;
            border: none;
            background: #f59e0b;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin-left: 8px;
            white-space: nowrap;
        }

        .btn-model-reset:hover {
            background: #d97706;
        }

        .btn-model-reset i {
            margin-right: 4px;
        }

        .btn-new-model {
            padding: 8px 20px;
            border: none;
            background: #409eff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .btn-new-model:hover {
            background: #66b1ff;
        }

        .model-table-container {
            background: white;
            border-radius: 4px;
            overflow-x: auto;
        }

        .model-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .model-table thead {
            background: #f5f7fa;
        }

        .model-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #606266;
            border-bottom: 1px solid #e4e7ed;
        }

        .model-table td {
            padding: 12px 16px;
            font-size: 14px;
            color: #606266;
            border-bottom: 1px solid #f0f2f5;
        }

        .model-table tbody tr:hover {
            background: #f5f7fa;
        }

        .model-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
        }

        .model-status.enabled {
            background: #e1f3d8;
            color: #67c23a;
        }

        .status-select {
            padding: 4px 8px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            background: white;
            font-size: 13px;
            cursor: pointer;
        }

        .model-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-link {
            padding: 4px 8px;
            border: none;
            background: none;
            color: #409eff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .btn-link:hover {
            color: #66b1ff;
            text-decoration: underline;
        }

        .model-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-top: 1px solid #e4e7ed;
        }

        .model-pagination .pagination-info {
            font-size: 14px;
            color: #606266;
        }

        .model-pagination .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 训练目标列表样式 */
        .training-targets-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }

        .training-target-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e4e7ed;
        }

        .training-target-row .form-col-model {
            flex: 1;
            min-width: 0;
        }

        .training-target-row .form-col-model label {
            display: block;
            font-size: 12px;
            color: #606266;
            margin-bottom: 5px;
        }

        .training-target-row select,
        .training-target-row input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn-remove-target {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border: none;
            background: #f56c6c;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-remove-target:hover {
            background: #f78989;
        }

        .btn-add-target {
            width: 100%;
            padding: 10px;
            border: 1px dashed #409eff;
            background: white;
            color: #409eff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-add-target:hover {
            background: #ecf5ff;
            border-color: #66b1ff;
        }

        .btn-add-target i {
            font-size: 16px;
        }

        /* 设备选择列表样式 */
        .device-selection-section {
            margin-top: 10px;
        }

        .device-selection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
            margin-top: 10px;
        }

        .device-selection-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e4e7ed;
        }

        .device-selection-row .form-col-model {
            flex: 1;
            min-width: 0;
        }

        .device-selection-row select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn-remove-device {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border: none;
            background: #f56c6c;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-remove-device:hover {
            background: #f78989;
        }

        .btn-add-device {
            width: 100%;
            padding: 10px;
            border: 1px dashed #67c23a;
            background: white;
            color: #67c23a;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-add-device:hover {
            background: #f0f9ff;
            border-color: #85ce61;
        }

        .btn-add-device i {
            font-size: 16px;
        }

        /* 全局时间过滤增强样式 */
        .enhanced-filter {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .enhanced-select {
            min-width: 120px;
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .enhanced-select:hover {
            border-color: #6366f1;
        }

        .enhanced-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-info {
            font-size: 12px;
            color: #6b7280;
            font-style: italic;
        }

        .time-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: auto;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 分类故障率样式 */
        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
        }

        .category-name {
            font-weight: 500;
            color: #374151;
        }

        .fault-rate {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .fault-rate.low-risk {
            background: #dcfce7;
            color: #166534;
        }

        .fault-rate.medium-risk {
            background: #fef3c7;
            color: #92400e;
        }

        .fault-rate.high-risk {
            background: #fee2e2;
            color: #dc2626;
        }

        .device-count {
            font-size: 12px;
            color: #6b7280;
        }

        .no-data {
            text-align: center;
            color: #9ca3af;
            padding: 20px;
            font-style: italic;
        }

        /* Toast消息样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* 加载状态样式 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========================================
           预测数据展示功能样式
           ======================================== */

        /* 风险项样式 */
        .risk-item {
            transition: all 0.3s ease;
        }

        .risk-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .risk-high {
            background: #fff1f0;
            border-left-color: #f5222d !important;
        }

        .risk-medium {
            background: #fffbe6;
            border-left-color: #faad14 !important;
        }

        .risk-low {
            background: #f6ffed;
            border-left-color: #52c41a !important;
        }

        /* 统计卡片样式 */
        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2) !important;
        }

        /* 空状态样式 */
        .empty-state {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 报告详情样式 */
        .report-detail .detail-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .report-detail .detail-row label {
            width: 120px;
            font-weight: 500;
            color: #666;
        }

        .report-detail .detail-row span {
            flex: 1;
            color: #333;
        }

        /* 时间筛选器样式 */
        .time-filter-container {
            background: #f5f5f5;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .time-filter-container .form-control {
            height: 36px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
        }

        .time-filter-container .btn {
            height: 36px;
            padding: 0 20px;
            border-radius: 4px;
        }

        /* 风险列表样式 */
        .risk-list .risk-item {
            border-radius: 8px;
            border-left: 4px solid;
        }

        .risk-header h5 {
            margin: 0;
            font-size: 16px;
        }

        .risk-level-badge {
            font-weight: 500;
        }

        /* 分析页面样式 */
        .analysis-page {
            padding: 20px;
        }

        .statistics-section h4,
        .trend-section h4,
        .risk-distribution-section h4,
        .category-section h4 {
            color: #333;
            font-weight: 500;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>人工智能运维平台</h2>
            </div>
            <div class="sidebar-item nav-overview">
                <i class="fas fa-tachometer-alt"></i>
                <span>总览</span>
            </div>
            <div class="sidebar-item nav-view">
                <i class="fas fa-eye"></i>
                <span>视图</span>
            </div>
            <div class="sidebar-item nav-alert">
                <i class="fas fa-bell"></i>
                <span>告警中心</span>
            </div>
            <div class="sidebar-item nav-device">
                <i class="fas fa-server"></i>
                <span>设备管理</span>
            </div>
            <div class="sidebar-item nav-network">
                <i class="fas fa-network-wired"></i>
                <span>网络拓扑</span>
            </div>
            <div class="sidebar-item nav-report">
                <i class="fas fa-chart-line"></i>
                <span>统计报表</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-tools"></i>
                <span>运维工具</span>
            </div>
            <div class="sidebar-item">
                <i class="fas fa-desktop"></i>
                <span>数字大屏</span>
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-group-title">拓展中心</div>
            <div class="sidebar-item nav-business">
                <i class="fas fa-layer-group"></i>
                <span>业务管理</span>
            </div>
            <div class="sidebar-item nav-network-mgmt">
                <i class="fas fa-globe"></i>
                <span>网络管理</span>
            </div>
            <div class="sidebar-item nav-video">
                <i class="fas fa-video"></i>
                <span>视频管理</span>
            </div>
            <div class="sidebar-item nav-room">
                <i class="fas fa-building"></i>
                <span>机房管理</span>
            </div>
            <div class="sidebar-item nav-asset">
                <i class="fas fa-cubes"></i>
                <span>资产管理</span>
            </div>
            <div class="sidebar-item nav-operation">
                <i class="fas fa-user-cog"></i>
                <span>运维管理</span>
            </div>
            <div class="sidebar-item nav-cmdb">
                <i class="fas fa-database"></i>
                <span>CMDB</span>
            </div>
            <div class="sidebar-item nav-log">
                <i class="fas fa-file-alt"></i>
                <span>日志管理</span>
            </div>
            <div class="sidebar-item nav-prediction active">
                <i class="fas fa-chart-pie"></i>
                <span>智能预测管理</span>
            </div>
            <div class="sidebar-item nav-cloud">
                <i class="fas fa-cloud"></i>
                <span>云平台</span>
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-group-title">设置中心</div>
            <div class="sidebar-item nav-settings">
                <i class="fas fa-cog"></i>
                <span>设置</span>
            </div>
            <div class="sidebar-item nav-docking">
                <i class="fas fa-plug"></i>
                <span>对接配置</span>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <header class="top-header">
                <div class="header-left">
                    <div class="breadcrumb">
                        <span class="breadcrumb-item">智能预测管理</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item" id="currentSubPage">算法模型服务</span>
                    </div>
                </div>
                <div class="header-right">
                    <!-- 用户下拉菜单容器 -->
                    <div id="user-dropdown-container"></div>
                </div>
            </header>

            <!-- 页面内容 -->
            <div class="page-content">
                <!-- 智能预测管理内容区域 -->
                <div class="prediction-container">
                    <!-- 左侧预测分类树 -->
                    <div class="prediction-tree">
                        <div class="tree-header">
                            <h3>智能预测管理</h3>
                        </div>
                        <div class="tree-content">
                            <div class="tree-node has-children">
                                <div class="node-item parent-node" data-page="stats">
                                    <i class="fas fa-chevron-right expand-icon"></i>
                                    <i class="fas fa-chart-pie node-icon"></i>
                                    <span class="node-text">智能统计</span>
                                </div>
                                <div class="sub-nodes">
                                    <div class="node-item sub-node" data-sub-page="stats-overview">
                                        <i class="fas fa-chart-bar node-icon"></i>
                                        <span class="node-text">概览</span>
                                    </div>
                                    <div class="node-item sub-node" data-sub-page="stats-report">
                                        <i class="fas fa-file-alt node-icon"></i>
                                        <span class="node-text">预测报告</span>
                                    </div>
                                    <div class="node-item sub-node" data-sub-page="stats-risk">
                                        <i class="fas fa-exclamation-triangle node-icon"></i>
                                        <span class="node-text">预测风险</span>
                                    </div>
                                </div>
                            </div>
                            <div class="tree-node">
                                <div class="node-item" data-page="analysis">
                                    <i class="fas fa-brain node-icon"></i>
                                    <span class="node-text">智能分析</span>
                                </div>
                            </div>
                            <div class="tree-node">
                                <div class="node-item selected" data-page="model-service">
                                    <i class="fas fa-server node-icon"></i>
                                    <span class="node-text">算法模型服务</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧主要内容区域 -->
                    <div class="prediction-main">
                        <!-- 智能统计页面 -->
                        <div class="sub-page" id="page-stats">
                            <!-- 统计概览子页面 -->
                            <div class="stats-sub-page active" id="page-stats-overview">
                                <!-- 顶部三列布局 -->
                                <div class="overview-top-row">
                                    <!-- 左侧：按设备分类统计 -->
                                    <div class="overview-card">
                                        <div class="card-header">
                                            <h4>按设备分类统计</h4>
                                            <div class="stats-filter enhanced-filter">
                                                <label>数据时间范围</label>
                                                <select class="time-select enhanced-select" id="predictionTimeSelect" onchange="onPredictionTimeChange()">
                                                    <option value="1" selected>最近1天</option>
                                                    <option value="7">最近7天</option>
                                                    <option value="30">最近30天</option>
                                                    <option value="90">最近3个月</option>
                                                </select>
                                                <span class="filter-info">影响所有预测相关数据</span>
                                            </div>
                                        </div>
                                        <div class="stats-section-title">智能分析能力统计</div>
                                        <div class="smart-stats-grid">
                                            <div class="smart-stat-item">
                                                <div class="stat-number" id="totalTrainingObjects">0</div>
                                                <div class="stat-label">总训练对象</div>
                                            </div>
                                            <div class="smart-stat-item">
                                                <div class="stat-number" id="enabledStrategies">2</div>
                                                <div class="stat-label">智能策略</div>
                                                <div class="stat-sublabel">启用：<span id="enabledStrategiesLabel">2</span></div>
                                            </div>
                                            <div class="smart-stat-item">
                                                <div class="stat-number" id="totalTrainingModels">0</div>
                                                <div class="stat-label">总训练模型数</div>
                                            </div>
                                            <div class="smart-stat-item">
                                                <div class="stat-number" id="totalTrainingRecords">0</div>
                                                <div class="stat-label">总训练次数</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 中间：各设备故障占比 -->
                                    <div class="overview-card">
                                        <div class="card-header">
                                            <h4>各设备故障占比</h4>
                                            <span class="time-badge">最近1天</span>
                                            <a href="#" class="view-details" onclick="switchStatsSubPage('stats-report'); return false;">查看预测报告 ></a>
                                        </div>
                                        <div class="device-fault-info">
                                            <span class="device-count">设备总数: <strong class="device-total-count">0</strong></span>
                                            <span class="fault-rate">设备故障率: <strong style="color: #10b981;">0%</strong></span>
                                        </div>
                                        <div class="donut-chart-container">
                                            <div class="donut-chart" id="deviceFaultPieChart" style="width: 100%; height: 280px;"></div>
                                        </div>
                                    </div>

                                    <!-- 右侧：预测告警 -->
                                    <div class="overview-card">
                                        <div class="card-header">
                                            <h4>预测告警</h4>
                                            <span class="time-badge">最近1天</span>
                                            <a href="#" class="view-more" onclick="switchStatsSubPage('stats-risk'); return false;">更多 ></a>
                                        </div>
                                        <div class="alert-number" id="totalAlerts">0</div>
                                        <div class="mini-chart-container">
                                            <div id="alertTrendChart" style="width: 100%; height: 120px;"></div>
                                        </div>
                                        <div class="alert-indicators">
                                            <span class="alert-badge critical">
                                                <i class="fas fa-exclamation-triangle"></i> <span id="criticalCount">0</span>
                                            </span>
                                            <span class="alert-badge warning">
                                                <i class="fas fa-exclamation-circle"></i> <span id="warningCount">0</span>
                                            </span>
                                            <span class="alert-badge info">
                                                <i class="fas fa-info-circle"></i> <span id="infoCount">0</span>
                                            </span>
                                        </div>
                                        <div class="no-data-placeholder">
                                            <i class="fas fa-database"></i>
                                            <p>暂无数据</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 底部两个设备类型的详细统计卡片 -->
                                <div class="device-detail-cards">
                                    <!-- 服务器故障预测 -->
                                    <div class="device-detail-card">
                                        <div class="detail-card-header">
                                            <h5>服务器故障预测</h5>
                                        </div>
                                        <div class="detail-stats-row">
                                            <div class="detail-stat-item" id="serverStatusBadge">
                                                <i class="fas fa-check-circle"></i>
                                                <span class="status-label">正常</span>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="serverTotalDevices">0</div>
                                                <div class="stat-desc">总训练设备总数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="serverNormalCount">0</div>
                                                <div class="stat-desc">运基次数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="serverWarningCount">0</div>
                                                <div class="stat-desc">自动预测故障设备数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="serverFaultCount">0</div>
                                                <div class="stat-desc">存在预测预故障设备数</div>
                                            </div>
                                        </div>
                                        <div class="detail-charts-row">
                                            <div class="detail-mini-chart">
                                                <div class="chart-label">预测间隔最多的设备</div>
                                                <div class="chart-number" id="serverTrainCount">0</div>
                                            </div>
                                            <div class="detail-mini-chart">
                                                <div class="chart-label">预测间隔最多的指标</div>
                                                <div class="chart-number" id="serverPredictionCount">0</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 其他故障预测 -->
                                    <div class="device-detail-card">
                                        <div class="detail-card-header">
                                            <h5>其他故障预测</h5>
                                        </div>
                                        <div class="detail-stats-row">
                                            <div class="detail-stat-item" id="otherStatusBadge">
                                                <i class="fas fa-check-circle"></i>
                                                <span class="status-label">正常</span>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="otherTotalDevices">0</div>
                                                <div class="stat-desc">总训练设备总数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="otherNormalCount">0</div>
                                                <div class="stat-desc">运基次数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="otherWarningCount">0</div>
                                                <div class="stat-desc">自动预测故障设备数</div>
                                            </div>
                                            <div class="detail-stat-item">
                                                <div class="stat-value" id="otherFaultCount">0</div>
                                                <div class="stat-desc">存在预测预故障设备数</div>
                                            </div>
                                        </div>
                                        <div class="detail-charts-row">
                                            <div class="detail-mini-chart">
                                                <div class="chart-label">预测间隔最多的设备</div>
                                                <div class="chart-number" id="otherTrainCount">0</div>
                                            </div>
                                            <div class="detail-mini-chart">
                                                <div class="chart-label">预测间隔最多的指标</div>
                                                <div class="chart-number" id="otherPredictionCount">0</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 预测报告子页面 -->
                            <div class="stats-sub-page" id="page-stats-report">
                                <!-- 左右布局容器 -->
                                <div style="display: flex; gap: 20px; height: calc(100vh - 200px);">
                                    <!-- 左侧分类栏 -->
                                    <div class="prediction-category-sidebar" style="width: 220px; background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow-y: auto;">
                                        <div class="category-header" style="padding: 10px 0; border-bottom: 1px solid #eee; margin-bottom: 10px;">
                                            <h4 style="margin: 0; font-size: 16px; color: #303133;">分类</h4>
                                        </div>
                                        <div id="predictionCategoryTree" class="category-tree">
                                            <div style="text-align: center; padding: 20px; color: #909399; font-size: 14px;">加载中...</div>
                                        </div>
                                    </div>

                                    <!-- 右侧图表展示区 -->
                                    <div class="prediction-chart-area" style="flex: 1; background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow-y: auto;">
                                        <!-- 顶部工具栏 -->
                                        <div class="chart-toolbar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                                            <div class="chart-title" style="font-size: 18px; font-weight: 600; color: #303133;">
                                                <span id="currentCategoryName">请选择分类</span>
                                            </div>
                                            <div class="chart-filters" style="display: flex; gap: 10px; align-items: center;">
                                                <select id="reportPredictionTimeSelect" style="padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px; cursor: pointer;">
                                                    <option value="1">预测时间: 1天</option>
                                                    <option value="3">预测时间: 3天</option>
                                                    <option value="7">预测时间: 7天</option>
                                                    <option value="30">预测时间: 30天</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- 图表内容区域 -->
                                        <div id="predictionChartContent" style="min-height: 400px;">
                                            <div style="display: flex; align-items: center; justify-content: center; height: 400px; color: #909399;">
                                                <div style="text-align: center;">
                                                    <i class="fas fa-chart-line" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
                                                    <p style="font-size: 14px; margin: 0;">请从左侧选择分类查看预测报告</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 预测风险子页面 -->
                            <div class="stats-sub-page" id="page-stats-risk">
                                <!-- 筛选条件区 -->
                                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <label style="font-size: 14px; color: #606266;">预测时间:</label>
                                            <select id="riskTimeFilter" style="padding: 6px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;">
                                                <option value="1">1 天</option>
                                                <option value="3">3 天</option>
                                                <option value="7">7 天</option>
                                                <option value="15">15 天</option>
                                                <option value="30">30 天</option>
                                            </select>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <label style="font-size: 14px; color: #606266;">风险等级:</label>
                                            <select id="riskLevelFilter" style="padding: 6px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;">
                                                <option value="">全部等级</option>
                                                <option value="critical">严重风险</option>
                                                <option value="high">高风险</option>
                                                <option value="medium">中风险</option>
                                                <option value="low">低风险</option>
                                            </select>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <label style="font-size: 14px; color: #606266;">风险状态:</label>
                                            <select id="riskStatusFilter" style="padding: 6px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;">
                                                <option value="">全部状态</option>
                                                <option value="active">活跃</option>
                                                <option value="resolved">已解决</option>
                                                <option value="acknowledged">已确认</option>
                                            </select>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <label style="font-size: 14px; color: #606266;">故障类型:</label>
                                            <select id="riskTargetFilter" style="padding: 6px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;">
                                                <option value="">全部故障类型</option>
                                            </select>
                                        </div>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="text" id="riskKeyword" placeholder="输入关键字..." style="flex: 1; padding: 6px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;">
                                            <button id="riskSearchBtn" style="padding: 6px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                                <i class="fas fa-search"></i> 搜索
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 风险统计区 -->
                                <div id="riskStatisticsContainer" style="margin-bottom: 20px;"></div>
                                
                                <!-- 风险列表区 -->
                                <div id="riskListContainer"></div>
                            </div>
                        </div>

                        <!-- 智能分析页面 -->
                        <div class="sub-page" id="page-analysis">
                            <div class="page-header" style="margin-bottom: 20px;">
                                <h2>智能分析</h2>
                            </div>

                            <!-- 时间筛选器容器 -->
                            <div id="analysisTimeFilter"></div>

                            <!-- 分析内容容器 -->
                            <div id="analysisContainer"></div>
                        </div>

                        <!-- 算法模型服务页面 -->
                        <div class="sub-page active" id="page-model-service">
                            <!-- 顶部工具栏 -->
                            <div class="model-toolbar">
                                <div class="toolbar-left-filters">
                                    <select class="model-select" name="status">
                                        <option value="" disabled selected>选择状态</option>
                                        <option value="1">启用</option>
                                        <option value="0">停用</option>
                                    </select>
                                    <select class="model-select" name="algorithmTypeFilter">
                                        <option value="" disabled selected>选择计算方法</option>
                                        <option value="KNN">KNN多变量时间序列预测</option>
                                        <option value="Prophet">Prophet时间序列预测</option>
                                        <option value="LSTM">LSTM深度学习预测</option>
                                        <option value="ARIMA">ARIMA统计预测</option>
                                        <option value="XGBoost">XGBoost机器学习预测</option>
                                    </select>
                                    <button class="btn-model-search">
                                        <i class="fas fa-search"></i>
                                    </button>
                                    <button class="btn-model-reset">
                                        <i class="fas fa-redo"></i>
                                        重置
                                    </button>
                                </div>
                                <div class="toolbar-right-actions">
                                    <button class="btn-new-model">
                                        <i class="fas fa-plus"></i>
                                        新建算法模型服务
                                    </button>
                                </div>
                            </div>

                            <!-- 数据表格 -->
                            <div class="model-table-container">
                                <table class="model-table">
                                    <thead>
                                        <tr>
                                            <th>状态</th>
                                            <th>算法模型服务名称</th>
                                            <th>训练对象</th>
                                            <th>模型数量</th>
                                            <th>更新时间</th>
                                            <th>计算方法</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span class="model-status enabled">▶ 启用</span></td>
                                            <td>PropSet123对型</td>
                                            <td>对控读取数据</td>
                                            <td>所有加防</td>
                                            <td>2025-01-02 05:00:00</td>
                                            <td>Prophet</td>
                                            <td>
                                                <div class="model-actions">
                                                    <button class="btn-link">停用</button>
                                                    <button class="btn-link">设置预测策略</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="model-status enabled">▶ 启用</span></td>
                                            <td>123</td>
                                            <td>对控读取数据</td>
                                            <td>CpuOS利用率</td>
                                            <td>2025-11-05 23:07:52</td>
                                            <td>KNN多变量时间序列预测</td>
                                            <td>
                                                <div class="model-actions">
                                                    <button class="btn-link">停用</button>
                                                    <button class="btn-link">编辑</button>
                                                    <button class="btn-link">删除</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <!-- 分页器 -->
                                <div class="model-pagination">
                                    <div class="pagination-info">
                                        共计2条信息，20条/页，第1页，总共1页
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="page-btn">
                                            <i class="fas fa-angle-left"></i>
                                        </button>
                                        <input type="text" class="page-input" value="1" />
                                        <button class="page-btn">
                                            <i class="fas fa-angle-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新建算法模型服务弹窗 -->
    <div class="model-service-modal" id="modelServiceModal">
        <div class="modal-content-model">
            <div class="modal-header-model">
                <h3 id="modelServiceModalTitle">新建算法模型服务</h3>
                <button class="modal-close-btn" onclick="closeModelServiceModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="modelServiceForm" class="modal-body-model">
                <input type="hidden" id="modelServiceId" name="id">
                
                <!-- 步骤1: 选择计算方式 -->
                <div class="form-step-model">
                    <div class="step-header-model">
                        <div class="step-number-model">1</div>
                        <h4 class="step-title-model">选择计算方式</h4>
                    </div>
                    <div class="step-content-model">
                        <div class="form-group-model">
                            <label>计算方法:</label>
                            <div class="algorithm-selection">
                                <div class="algorithm-option selected" data-value="KNN">
                                    <span class="algorithm-name">KNN多变量时间序列预测</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 步骤2: 选择数据源 -->
                <div class="form-step-model">
                    <div class="step-header-model">
                        <div class="step-number-model">2</div>
                        <h4 class="step-title-model">选择数据源</h4>
                    </div>
                    <div class="step-content-model">
                        <div class="data-source-section">
                            <div class="form-group-model">
                                <label><span style="color: red;">*</span> 配置训练目标:</label>
                                <div class="device-selection-section">
                                    <label class="sub-label">选择设备:</label>
                                    <div id="deviceSelectionList" class="device-selection-list">
                                        <!-- 动态添加的设备选择行 -->
                                    </div>
                                    <button type="button" class="btn-add-device" onclick="addDeviceSelectionRow()">
                                        <i class="fas fa-plus-circle"></i> 添加设备
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group-model">
                                <label><span style="color: red;">*</span> 选择训练指标:</label>
                                <div id="trainingTargetsList" class="training-targets-list">
                                    <!-- 动态添加的训练目标行 -->
                                </div>
                                <button type="button" class="btn-add-target" onclick="addTrainingTargetRow()">
                                    <i class="fas fa-plus-circle"></i> 添加训练目标
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- 步骤3: 配置模型参数 -->
                <div class="form-step-model">
                    <div class="step-header-model">
                        <div class="step-number-model">3</div>
                        <h4 class="step-title-model">配置模型参数</h4>
                    </div>
                    <div class="step-content-model">
                        <div class="form-group-model">
                            <label></label>
                            <div class="form-row-model">
                                <div class="form-col-model">
                                    <label class="sub-label">模型更新周期:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="updateCycle" name="updateCycle" value="7" min="1">
                                        <span class="unit">天</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 步骤4: 配置预测策略 -->
                <div class="form-step-model">
                    <div class="step-header-model">
                        <div class="step-number-model">4</div>
                        <h4 class="step-title-model">配置预测策略</h4>
                    </div>
                    <div class="step-content-model">
                        <div class="form-group-model">
                            <label>自动预测:</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="autoPrediction" name="autoPrediction" checked>
                                <label for="autoPrediction" class="toggle-label"></label>
                            </div>
                        </div>
                        
                        <div class="form-group-model">
                            <label>预测周期时间:</label>
                            <div class="form-row-model">
                                <div class="form-col-model">
                                    <div class="input-with-unit">
                                        <input type="number" id="predictionCycle" name="predictionCycle" value="1" min="1">
                                        <span class="unit">天</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group-model">
                            <label>预测时长:</label>
                            <div class="form-row-model">
                                <div class="form-col-model">
                                    <div class="input-with-unit">
                                        <input type="number" id="predictionDuration" name="predictionDuration" value="1" min="1" max="30">
                                        <span class="unit">天</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 步骤5: 基本信息 -->
                <div class="form-step-model">
                    <div class="step-header-model">
                        <div class="step-number-model">5</div>
                        <h4 class="step-title-model">基本信息</h4>
                    </div>
                    <div class="step-content-model">
                        <div class="form-group-model">
                            <label>算法模型服务名称:</label>
                            <input type="text" id="serviceName" name="serviceName" placeholder="" required>
                        </div>
                        
                        <div class="form-group-model">
                            <label>备注</label>
                            <textarea id="serviceNotes" name="serviceNotes" placeholder="" rows="4"></textarea>
                        </div>
                    </div>
                </div>
            </form>
            
            <div class="modal-footer-model">
                <button type="button" class="btn-cancel-model" onclick="closeModelServiceModal()">取消</button>
                <button type="button" class="btn-save-model" onclick="saveModelService()">保存</button>
            </div>
        </div>
    </div>

    <!-- 训练历史模态框 -->
    <div id="trainingHistoryModal" class="modal-overlay-model" style="display: none;">
        <div class="modal-content-model" style="max-width: 1200px;">
            <div class="modal-header-model">
                <h3 id="trainingHistoryTitle">模型组合列表</h3>
            </div>
            
            <div class="modal-body-model" style="padding: 20px;">
                <!-- 筛选区域 -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
                    <div style="flex: 1;">
                        <label style="margin-right: 8px;">状态</label>
                        <select id="trainStatusFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                            <option value="">全部</option>
                            <option value="success">训练完成</option>
                            <option value="failed">训练失败</option>
                            <option value="running">训练中</option>
                            <option value="pending">待训练</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="margin-right: 8px;">选择设备</label>
                        <select id="trainDeviceFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                            <option value="">全部</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="margin-right: 8px;">选择监测指标</label>
                        <select id="trainMetricFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                            <option value="">全部</option>
                        </select>
                    </div>
                    <div style="flex: 0; display: flex; gap: 10px;">
                        <button onclick="searchTrainingHistory()" 
                                style="padding: 8px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                       color: white; border: none; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-search"></i> 搜索
                        </button>
                        <button onclick="resetTrainingHistoryFilters()" 
                                style="padding: 8px 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                                       color: white; border: none; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-redo"></i> 重置
                        </button>
                    </div>
                </div>

                <!-- 训练历史表格 -->
                <div style="overflow-x: auto;">
                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 12px; text-align: left;">当前状态</th>
                                <th style="padding: 12px; text-align: left;">检测类型</th>
                                <th style="padding: 12px; text-align: left;">设备名称</th>
                                <th style="padding: 12px; text-align: left;">监测指标</th>
                                <th style="padding: 12px; text-align: left;">备注</th>
                                <th style="padding: 12px; text-align: left;">创建时间</th>
                                <th style="padding: 12px; text-align: left;">最近一次训练时间</th>
                                <th style="padding: 12px; text-align: left;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="trainingHistoryTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px;">
                                    <div style="color: #999;">
                                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 10px;"></i>
                                        <p>暂无数据</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="modal-footer-model">
                <button type="button" class="btn-cancel-model" onclick="closeTrainingHistoryModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 训练详情模态框 -->
    <div id="trainingDetailsModal" class="modal-overlay-model" style="display: none;">
        <div class="modal-content-model" style="max-width: 1000px;">
            <div class="modal-header-model">
                <h3 id="trainingDetailsTitle">训练详情</h3>
                <button type="button" class="modal-close-model" onclick="closeTrainingDetailsModal()">×</button>
            </div>
            
            <div class="modal-body-model" style="max-height: 600px; overflow-y: auto;">
                <!-- 模型基本信息 -->
                <div class="training-details-card">
                    <div class="details-header">
                        <h4><i class="fas fa-info-circle"></i> 模型基本信息</h4>
                    </div>
                    <div class="details-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>设备名称</label>
                                <span id="detailDeviceName">-</span>
                            </div>
                            <div class="info-item">
                                <label>监控类型</label>
                                <span id="detailMonitoringType">-</span>
                            </div>
                            <div class="info-item">
                                <label>监控指标</label>
                                <span id="detailMonitoringMetric">-</span>
                            </div>
                            <div class="info-item">
                                <label>当前状态</label>
                                <span id="detailStatus">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 训练历史记录 -->
                <div class="training-details-card">
                    <div class="details-header">
                        <h4><i class="fas fa-history"></i> 训练历史记录</h4>
                    </div>
                    <div class="details-content">
                        <div class="training-history-timeline" id="trainingHistoryTimeline">
                            <!-- 动态加载训练历史 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer-model">
                <button type="button" class="btn-cancel-model" onclick="closeTrainingDetailsModal()">关闭</button>
            </div>
        </div>
    </div>

    <script src="js/navigation-fix.js"></script>
    <script src="js/user-dropdown-loader.js"></script>
    <script>
        // 子页面切换功能
        function switchSubPage(pageName) {
            console.log('🔄 切换到页面:', pageName);
            
            // 隐藏所有子页面
            document.querySelectorAll('.sub-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示目标页面
            const targetPage = document.getElementById('page-' + pageName);
            if (targetPage) {
                targetPage.classList.add('active');
                console.log('✅ 页面切换成功:', pageName);
            } else {
                console.error('❌ 未找到页面:', 'page-' + pageName);
            }
            
            // 更新面包屑
            const pageNames = {
                'stats': '智能统计',
                'analysis': '智能分析',
                'model-service': '算法模型服务'
            };
            const breadcrumbElement = document.getElementById('currentSubPage');
            if (breadcrumbElement) {
                breadcrumbElement.textContent = pageNames[pageName] || '算法模型服务';
            }
            
            // 初始化智能分析页面
            if (pageName === 'analysis') {
                setTimeout(function() {
                    if (typeof initPredictionAnalysisPage === 'function') {
                        console.log('🚀 初始化智能分析页面...');
                        initPredictionAnalysisPage();
                    } else {
                        console.error('❌ initPredictionAnalysisPage 函数不存在');
                    }
                }, 300);
            }
            
            // 初始化算法模型服务页面
            if (pageName === 'model-service') {
                setTimeout(function() {
                    if (typeof window.initModelServicePage === 'function') {
                        console.log('🚀 初始化算法模型服务页面...');
                        window.initModelServicePage();
                    } else {
                        console.error('❌ initModelServicePage 函数不存在');
                    }
                }, 300);
            }
        }

        // 使用事件委托绑定树形菜单点击事件（避免重复绑定）
        let isProcessingClick = false; // 防抖标志
        
        document.querySelector('.tree-content')?.addEventListener('click', function(e) {
            // 查找最近的.node-item元素
            const nodeItem = e.target.closest('.node-item');
            if (!nodeItem || isProcessingClick) return;
            
            // 设置防抖
            isProcessingClick = true;
            setTimeout(() => { isProcessingClick = false; }, 300);
            
            e.stopPropagation();
            
            // 如果是父节点，只处理展开/收起，不切换页面
            if (nodeItem.classList.contains('parent-node')) {
                const treeNode = nodeItem.closest('.tree-node');
                const wasExpanded = treeNode.classList.contains('expanded');
                treeNode.classList.toggle('expanded');
                
                // 如果从收起变为展开，确保父页面显示并选中第一个子节点
                if (!wasExpanded && treeNode.classList.contains('expanded')) {
                    const pageName = nodeItem.getAttribute('data-page');
                    if (pageName === 'stats') {
                        // 切换到智能统计页面
                        switchSubPage('stats');
                        
                        // 默认选中第一个子页面
                        const firstSubNode = treeNode.querySelector('.sub-node');
                        if (firstSubNode) {
                            const subPageName = firstSubNode.getAttribute('data-sub-page');
                            if (subPageName) {
                                switchStatsSubPage(subPageName);
                                
                                // 清除所有子节点选中状态
                                document.querySelectorAll('.sub-node').forEach(node => {
                                    node.classList.remove('selected');
                                });
                                // 选中第一个子节点
                                firstSubNode.classList.add('selected');
                            }
                        }
                        
                        // 清除父节点和其他普通节点的选中状态
                        document.querySelectorAll('.node-item:not(.sub-node)').forEach(node => {
                            node.classList.remove('selected');
                        });
                    }
                }
            } 
            // 如果是子节点，切换子页面
            else if (nodeItem.classList.contains('sub-node')) {
                const subPageName = nodeItem.getAttribute('data-sub-page');
                if (subPageName) {
                    // 确保父节点展开
                    const treeNode = nodeItem.closest('.tree-node');
                    if (treeNode && !treeNode.classList.contains('expanded')) {
                        treeNode.classList.add('expanded');
                    }
                    
                    // 确保在智能统计页面
                    switchSubPage('stats');
                    
                    // 切换子页面
                    switchStatsSubPage(subPageName);
                    
                    // 清除所有节点选中状态
                    document.querySelectorAll('.node-item').forEach(node => {
                        node.classList.remove('selected');
                    });
                    // 选中当前子节点
                    nodeItem.classList.add('selected');
                }
            }
            // 普通节点（智能分析、算法模型服务）
            else {
                const pageName = nodeItem.getAttribute('data-page');
                if (pageName) {
                    // 切换页面
                    switchSubPage(pageName);
                    
                    // 清除所有节点选中状态
                    document.querySelectorAll('.node-item').forEach(node => {
                        node.classList.remove('selected');
                    });
                    // 选中当前节点
                    nodeItem.classList.add('selected');
                    
                    // 收起智能统计的展开状态
                    const statsTreeNode = document.querySelector('.parent-node[data-page="stats"]')?.closest('.tree-node');
                    if (statsTreeNode) {
                        statsTreeNode.classList.remove('expanded');
                    }
                }
            }
        });

        // 智能统计子页面切换
        function switchStatsSubPage(subPageName) {
            // 隐藏所有智能统计子页面
            document.querySelectorAll('.stats-sub-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示目标子页面
            const targetPage = document.getElementById('page-' + subPageName);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // 更新面包屑
            const subPageNames = {
                'stats-overview': '智能统计 / 概览',
                'stats-report': '智能统计 / 预测报告',
                'stats-risk': '智能统计 / 预测风险'
            };
            document.getElementById('currentSubPage').textContent = subPageNames[subPageName] || '智能统计';
            
            // 初始化对应的页面
            if (subPageName === 'stats-report' && typeof window.initPredictionReportPage === 'function') {
                console.log('🔄 Switching to Prediction Report page, initializing...');
                window.initPredictionReportPage();
            } else if (subPageName === 'stats-risk' && typeof window.initPredictionRiskPage === 'function') {
                console.log('🔄 Switching to Prediction Risk page, initializing...');
                window.initPredictionRiskPage();
            }
        }

        // 页面加载时，默认展开智能统计（如果需要）
        // document.querySelector('.parent-node[data-page="stats"]')?.closest('.tree-node').classList.add('expanded');

        // 表格行hover效果
        document.querySelectorAll('.data-table tbody tr').forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
            });
            row.addEventListener('mouseleave', function() {
                this.style.boxShadow = 'none';
            });
        });

        // 按钮点击效果
        document.querySelectorAll('.btn-action, .btn-new').forEach(btn => {
            btn.addEventListener('click', function() {
                console.log('Button clicked:', this.textContent);
            });
        });

        // ==================== 算法模型服务管理功能 ====================

        // 全局变量存储检测模板数据
        let detectionTemplatesCache = null;

        // 从检测模板加载数据（关联设置页面的检测模板设置）
        function loadDetectionTemplates() {
            // 如果已有缓存，直接返回
            if (detectionTemplatesCache) {
                return Promise.resolve(detectionTemplatesCache);
            }

            // 从后端API获取检测模板数据
            return fetch('/api/detection-templates')
                .then(response => response.json())
                .then(result => {
                    if (result.code === 200) {
                        detectionTemplatesCache = result.data.map(template => ({
                            id: template.id,
                            templateName: template.templateName || template.template_name,
                            detectionType: template.detectionType || template.detection_type,
                            status: template.status
                        }));
                        return detectionTemplatesCache;
                    } else {
                        throw new Error(result.message || 'API调用失败');
                    }
                })
                .catch(error => {
                    console.error('加载检测模板失败:', error);
                    // 严格遵守“数据来自数据库”的原则：API失败时不返回模拟业务数据
                    detectionTemplatesCache = [];
                    return detectionTemplatesCache;
                });
        }

        // 监控类型显示名称映射（使用全局定义或本地定义）
        var localDetectionTypeNames = window.detectionTypeNames || {
            'cpu': 'CPU监控',
            'memory': '内存监控',
            'disk': '磁盘监控',
            'network': '网络监控',
            'temperature': '温度监控',
            'performance': '性能监控',
            'capacity': '容量监控',
            'fault': '故障检测',
            'health': '健康检查'
        };

        // 加载监控类型下拉框（从检测模板中提取唯一的检测类型）
        function loadMonitoringTypes() {
            loadDetectionTemplates().then(templates => {
                const categorySelect = document.getElementById('metricCategory');
                if (!categorySelect) return;

                // 提取唯一的检测类型
                const uniqueTypes = [...new Set(templates.map(t => t.detectionType))];

                // 清空并重新填充选项
                categorySelect.innerHTML = '<option value="">选择监控类型</option>';

                uniqueTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = localDetectionTypeNames[type] || type;
                    categorySelect.appendChild(option);
                });

                console.log('✅ 监控类型已加载:', uniqueTypes);
            });
        }

        // 根据选择的监控类型更新具体指标下拉框（从检测模板的模板名称中加载）
        function updateSpecificMetricsFromTemplates() {
            const categorySelect = document.getElementById('metricCategory');
            const specificSelect = document.getElementById('specificMetric');

            if (!categorySelect || !specificSelect) return;

            const selectedCategory = categorySelect.value;

            // 清空具体指标选项
            specificSelect.innerHTML = '<option value="">选择具体指标</option>';

            if (!selectedCategory) return;

            // 从检测模板中筛选出对应监控类型的模板
            loadDetectionTemplates().then(templates => {
                const filteredTemplates = templates.filter(t =>
                    t.detectionType === selectedCategory && t.status === 1
                );

                // 将模板名称作为具体指标选项
                filteredTemplates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.templateName;
                    option.dataset.templateId = template.id;
                    specificSelect.appendChild(option);
                });

                console.log(`✅ 已加载 ${selectedCategory} 的具体指标:`, filteredTemplates.length, '个');
            });
        }

        // 根据监控类型获取对应的检测模板
        function getTemplatesByMonitoringType(monitoringType) {
            return loadDetectionTemplates().then(templates => {
                return templates.filter(template =>
                    template.detectionType === monitoringType && template.status === 1
                );
            });
        }

        // 新建算法模型服务按钮点击事件（逻辑已迁移到 js/prediction-model-service.js）
        document.addEventListener('DOMContentLoaded', function() {
            // 这里只保留占位，实际按钮绑定由 prediction-model-service.js 完成
        });


        // 模态框函数已移至 prediction-model-service.js

        // 验证算法模型服务表单
        function validateModelServiceForm() {
            const serviceName = document.getElementById('serviceName').value.trim();
            
            if (!serviceName) {
                alert('请输入算法模型服务名称');
                document.getElementById('serviceName').focus();
                return false;
            }
            
            // 验证数值字段
            const updateCycle = document.getElementById('updateCycle').value;
            if (updateCycle && (isNaN(updateCycle) || parseInt(updateCycle) < 1)) {
                alert('模型更新周期必须是大于0的数字');
                document.getElementById('updateCycle').focus();
                return false;
            }
            
            const predictionCycle = document.getElementById('predictionCycle').value;
            if (predictionCycle && (isNaN(predictionCycle) || parseInt(predictionCycle) < 1)) {
                alert('预测周期时间必须是大于0的数字');
                document.getElementById('predictionCycle').focus();
                return false;
            }
            
            const predictionDuration = document.getElementById('predictionDuration').value;
            if (predictionDuration && (isNaN(predictionDuration) || parseInt(predictionDuration) < 1 || parseInt(predictionDuration) > 30)) {
                alert('预测时长必须是1-30天之间的数字');
                document.getElementById('predictionDuration').focus();
                return false;
            }
            
            return true;
        }

        // ESC键关闭弹窗
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('modelServiceModal');
                if (modal && modal.style.display === 'flex') {
                    closeModelServiceModal();
                }
            }
        });
    </script>
    
    <!-- ECharts图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <!-- 智能预测管理API模块 -->
    <script src="js/prediction-api.js"></script>
    
    <!-- 概览页面逻辑 -->
    <script src="js/prediction-overview.js"></script>
    
    <!-- 预测报告页面逻辑 -->
    <!-- <script src="js/prediction-report.js"></script> --> <!-- 已废弃，使用新版 -->
    
    <!-- 预测报告页面逻辑 - 新版 -->
    <script src="js/device-report-helper.js"></script>
    <script src="js/prediction-report-new.js"></script>
    
    <!-- 预测报告增强功能 -->
    <!-- <link rel="stylesheet" href="css/prediction-report-enhanced.css"> --> <!-- 已废弃 -->
    <!-- <script src="js/prediction-report-enhanced.js"></script> --> <!-- 已废弃 -->
    
    <!-- ECharts图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <!-- 预测风险页面逻辑 -->
    <script src="js/prediction-risk.js"></script>

    <!-- 算法模型服务页面逻辑 -->
    <script src="js/prediction-model-service.js"></script>

    <!-- 预测数据展示页面初始化 -->
    <script>
    $(document).ready(function() {
        console.log('预测数据展示功能初始化...');

        // 标记页面是否已初始化
        window.reportPageInitialized = false;
        window.riskPageInitialized = false;
        window.analysisPageInitialized = false;

        // 监听子页面切换事件（智能统计下的子页面）
        // ========== 旧的预测报告代码已废弃，使用 prediction-report-new.js ==========
        /* 已注释掉旧代码，避免覆盖新的JS文件
        // 预测报告页面功能
        let reportCurrentCategoryId = null;
        let reportCurrentPredictionTime = 1;
        let reportChartInstances = {};

        // 将函数设置为全局函数
        window.initPredictionReportPage = function() {
            console.log('=== 初始化预测报告页面 ===');
            loadReportCategories();

            // 绑定预测时间筛选器事件
            const timeFilter = document.getElementById('reportPredictionTimeFilter');
            if (timeFilter) {
                // 移除旧的事件监听器
                const newTimeFilter = timeFilter.cloneNode(true);
                timeFilter.parentNode.replaceChild(newTimeFilter, timeFilter);

                newTimeFilter.addEventListener('change', function() {
                    reportCurrentPredictionTime = this.value;
                    loadReportData();
                });
            }
        };

        async function loadReportCategories() {
            try {
                // 使用分类树API获取完整的分类结构
                const response = await fetch('/api/prediction/enhanced-reports/categories/tree');
                const result = await response.json();

                if (result.code === 200 && result.data) {
                    renderReportCategoryTree(result.data);
                } else {
                    showReportError('加载分类失败: ' + (result.message || '未知错误'));
                }
            } catch (error) {
                console.error('加载分类失败:', error);
                showReportError('加载分类失败: ' + error.message);
            }
        }

        function renderReportCategoryTree(categoryTree) {
            const categoryList = document.getElementById('reportCategoryList');
            if (!categoryList) return;

            categoryList.innerHTML = '';

            // 渲染分类树
            categoryTree.forEach(parentCategory => {
                // 创建父分类容器
                const parentContainer = document.createElement('div');
                parentContainer.style.cssText = 'margin-bottom: 8px;';

                // 创建父分类项
                const parentItem = document.createElement('div');
                parentItem.className = 'category-parent-item';
                parentItem.style.cssText = 'padding: 10px 12px; cursor: pointer; border-radius: 6px; background: #ecf5ff; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s;';

                const hasChildren = parentCategory.children && parentCategory.children.length > 0;
                const expandIcon = hasChildren ? '▼' : '';

                parentItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="expand-icon" style="font-size: 10px; transition: transform 0.3s; ${!hasChildren ? 'visibility: hidden;' : ''}">${expandIcon}</span>
                        <span style="font-size: 14px; font-weight: 500;">${parentCategory.categoryName}</span>
                    </div>
                `;

                // 创建子分类容器
                const childrenContainer = document.createElement('div');
                childrenContainer.className = 'children-container';
                childrenContainer.style.cssText = 'margin-left: 20px; margin-top: 5px; display: block;';

                // 渲染子分类
                if (hasChildren) {
                    parentCategory.children.forEach(childCategory => {
                        const childItem = document.createElement('div');
                        childItem.className = 'category-child-item';
                        childItem.style.cssText = 'padding: 8px 12px; cursor: pointer; border-radius: 4px; margin-bottom: 3px; font-size: 13px; transition: all 0.3s;';
                        childItem.textContent = childCategory.categoryName;
                        childItem.dataset.categoryId = childCategory.id;
                        childItem.dataset.categoryName = childCategory.categoryName;

                        // 子分类点击事件
                        childItem.onclick = function(e) {
                            e.stopPropagation();
                            selectReportCategory(childCategory.id, childCategory.categoryName, this);
                        };

                        // 子分类hover效果
                        childItem.onmouseenter = function() {
                            if (!this.classList.contains('active')) {
                                this.style.background = '#f5f7fa';
                            }
                        };
                        childItem.onmouseleave = function() {
                            if (!this.classList.contains('active')) {
                                this.style.background = '';
                            }
                        };

                        childrenContainer.appendChild(childItem);
                    });
                }

                // 父分类点击事件（展开/折叠）
                if (hasChildren) {
                    parentItem.onclick = function(e) {
                        e.stopPropagation();
                        const icon = this.querySelector('.expand-icon');
                        const isExpanded = childrenContainer.style.display !== 'none';

                        if (isExpanded) {
                            childrenContainer.style.display = 'none';
                            icon.style.transform = 'rotate(-90deg)';
                        } else {
                            childrenContainer.style.display = 'block';
                            icon.style.transform = 'rotate(0deg)';
                        }
                    };
                }

                parentContainer.appendChild(parentItem);
                if (hasChildren) {
                    parentContainer.appendChild(childrenContainer);
                }
                categoryList.appendChild(parentContainer);
            });

            // 默认选中第一个子分类
            const firstChild = categoryList.querySelector('.category-child-item');
            if (firstChild) {
                const categoryId = parseInt(firstChild.dataset.categoryId);
                const categoryName = firstChild.dataset.categoryName;
                selectReportCategory(categoryId, categoryName, firstChild);
            }
        }

        function selectReportCategory(categoryId, categoryName, element) {
            // 更新选中状态 - 清除所有子分类的选中状态
            document.querySelectorAll('#reportCategoryList .category-child-item').forEach(item => {
                item.classList.remove('active');
                item.style.background = '';
                item.style.color = '';
                item.style.borderLeft = '';
            });

            // 设置当前选中项的样式
            element.classList.add('active');
            element.style.background = '#ecf5ff';
            element.style.color = '#409eff';
            element.style.borderLeft = '3px solid #409eff';

            // 更新当前分类
            reportCurrentCategoryId = categoryId;
            const titleElement = document.getElementById('reportContentTitle');
            if (titleElement) {
                titleElement.textContent = categoryName;
            }

            // 加载报告
            loadReportData();
        }

        async function loadReportData() {
            const reportsGrid = document.getElementById('reportCardsGrid');
            if (!reportsGrid) return;

            reportsGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #909399;">加载中...</div>';

            try {
                let url = `/api/prediction/enhanced-reports/category-reports?predictionTime=${reportCurrentPredictionTime}`;
                if (reportCurrentCategoryId) {
                    url += `&categoryId=${reportCurrentCategoryId}`;
                }

                const response = await fetch(url);
                const result = await response.json();

                if (result.code === 200 && result.data) {
                    renderReportCards(result.data);
                    updateReportStats(result.data);
                } else {
                    showReportError('加载报告失败: ' + (result.message || '未知错误'));
                }
            } catch (error) {
                console.error('加载报告失败:', error);
                showReportError('加载报告失败: ' + error.message);
            }
        }

        function renderReportCards(reports) {
            const reportsGrid = document.getElementById('reportCardsGrid');
            if (!reportsGrid) return;

            if (!reports || reports.length === 0) {
                reportsGrid.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #909399; grid-column: 1 / -1;">
                        <div style="font-size: 64px; margin-bottom: 20px;">📊</div>
                        <div style="font-size: 16px;">暂无报告数据</div>
                    </div>
                `;
                return;
            }

            reportsGrid.innerHTML = '';

            reports.forEach(report => {
                const card = createReportCard(report);
                reportsGrid.appendChild(card);
            });

            // 渲染图表
            setTimeout(() => {
                reports.forEach(report => {
                    renderReportChart(report);
                });
            }, 100);
        }

        function createReportCard(report) {
            const card = document.createElement('div');
            card.style.cssText = 'background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); transition: all 0.3s;';

            const statusClass = report.status === 'NORMAL' ? 'normal' : report.status === 'WARNING' ? 'warning' : 'critical';
            const statusText = report.status === 'NORMAL' ? '正常' : report.status === 'WARNING' ? '警告' : '严重';
            const statusColor = report.status === 'NORMAL' ? '#67c23a' : report.status === 'WARNING' ? '#e6a23c' : '#f56c6c';
            const statusBg = report.status === 'NORMAL' ? '#f0f9ff' : report.status === 'WARNING' ? '#fdf6ec' : '#fef0f0';

            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="font-size: 16px; font-weight: 600;">${report.reportName || '设备健康度报告'}</div>
                    <div style="padding: 4px 12px; border-radius: 12px; font-size: 12px; background: ${statusBg}; color: ${statusColor};">${statusText}</div>
                </div>
                <div style="height: 200px; margin-bottom: 15px;">
                    <canvas id="report-chart-${report.id}"></canvas>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 1px solid #e4e7ed;">
                    <div style="font-size: 12px; color: #909399;">更新: ${formatReportTime(report.updatedAt)}</div>
                    <button onclick="viewReportDetail(${report.id})" style="padding: 6px 16px; background: #409eff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s;">查看</button>
                </div>
            `;

            // 添加hover效果
            card.onmouseenter = function() {
                this.style.boxShadow = '0 4px 16px rgba(0,0,0,0.15)';
                this.style.transform = 'translateY(-2px)';
            };
            card.onmouseleave = function() {
                this.style.boxShadow = '0 2px 12px rgba(0,0,0,0.1)';
                this.style.transform = 'translateY(0)';
            };

            return card;
        }

        function renderReportChart(report) {
            const canvas = document.getElementById(`report-chart-${report.id}`);
            if (!canvas) return;

            // 销毁旧图表
            if (reportChartInstances[report.id]) {
                reportChartInstances[report.id].destroy();
            }

            // 解析图表数据
            let chartData = { type: 'line', data: [65, 68, 70, 72, 69] };
            if (report.chartData) {
                try {
                    chartData = JSON.parse(report.chartData);
                } catch (e) {
                    console.error('解析图表数据失败:', e);
                }
            }

            // 创建新图表
            const ctx = canvas.getContext('2d');
            reportChartInstances[report.id] = new Chart(ctx, {
                type: chartData.type || 'line',
                data: {
                    labels: ['20:00', '13:00', '04:00', '08:00', '12:00'],
                    datasets: [{
                        label: '本机设备-健康评分',
                        data: chartData.data || [65, 68, 70, 72, 69],
                        borderColor: '#409eff',
                        backgroundColor: 'rgba(64, 158, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateReportStats(reports) {
            const statsCard = document.getElementById('reportStatsCard');
            if (!statsCard) return;

            const normalCount = reports.filter(r => r.status === 'NORMAL').length;
            const abnormalCount = reports.length - normalCount;

            document.getElementById('reportNormalCount').textContent = normalCount;
            document.getElementById('reportAbnormalCount').textContent = abnormalCount;

            statsCard.style.display = reports.length > 0 ? 'block' : 'none';
        }

        function viewReportDetail(reportId) {
            alert('查看报告详情: ' + reportId + '\n\n此功能将显示更详细的预测信息，包括：\n- 详细的健康度评分\n- 历史趋势分析\n- 异常检测结果\n- 预测建议');
        }

        function formatReportTime(timeStr) {
            if (!timeStr) return '-';
            const date = new Date(timeStr);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showReportError(message) {
            const reportsGrid = document.getElementById('reportCardsGrid');
            if (reportsGrid) {
                reportsGrid.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #909399; grid-column: 1 / -1;">
                        <div style="font-size: 64px; margin-bottom: 20px;">⚠️</div>
                        <div style="font-size: 16px;">${message}</div>
                    </div>
                `;
            }
        }
        */ // ========== 旧代码注释结束 ==========

        window.switchStatsSubPageOriginal = window.switchStatsSubPage;
        window.switchStatsSubPage = function(subPageId) {
            console.log('切换智能统计子页面:', subPageId);

            // 调用原始函数
            if (window.switchStatsSubPageOriginal) {
                window.switchStatsSubPageOriginal(subPageId);
            }

            // 根据页面ID初始化对应的功能
            setTimeout(function() {
                if (subPageId === 'stats-report') {
                    // 初始化预测报告页面
                    if (!window.reportPageInitialized && typeof initPredictionReportPage === 'function') {
                        console.log('初始化预测报告页面...');
                        initPredictionReportPage();
                        window.reportPageInitialized = true;
                    }
                } else if (subPageId === 'stats-risk') {
                    // 初始化预测风险页面
                    if (!window.riskPageInitialized && typeof initPredictionRiskPage === 'function') {
                        console.log('初始化预测风险页面...');
                        initPredictionRiskPage();
                        window.riskPageInitialized = true;
                    }
                }
            }, 100);
        };

        // 监听主页面切换事件
        window.switchToPageOriginal = window.switchToPage;
        window.switchToPage = function(pageId) {
            console.log('切换主页面:', pageId);

            // 调用原始函数
            if (window.switchToPageOriginal) {
                window.switchToPageOriginal(pageId);
            }

            // 根据页面ID初始化对应的功能
            setTimeout(function() {
                if (pageId === 'page-analysis') {
                    // 初始化智能分析页面（每次切换都重新初始化）
                    if (typeof initPredictionAnalysisPage === 'function') {
                        console.log('🚀 初始化智能分析页面...');
                        initPredictionAnalysisPage();
                    } else {
                        console.error('❌ initPredictionAnalysisPage 函数不存在');
                    }
                }
            }, 300);
        };

        console.log('预测数据展示功能初始化完成');
    });
    </script>
</body>
</html>
