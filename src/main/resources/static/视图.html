<!DOCTYPE html>
<html lang="zh-CN">
<head>
<style>
/* 立即隐藏CMDB菜单项 - 防止闪烁 */
.nav-cmdb { display: none !important; }
.sidebar-item[data-page="CMDB"] { display: none !important; }
</style>
<script>
// 立即执行：尽早隐藏CMDB，防止闪烁
(function() {
    function hideCMDB() {
        var items = document.querySelectorAll('.sidebar-item');
        items.forEach(function(item) {
            var span = item.querySelector('span');
            if (span && span.textContent.trim() === 'CMDB') {
                item.style.display = 'none';
                item.setAttribute('data-hidden', 'true');
            }
        });
    }
    
    // 立即执行
    hideCMDB();
    
    // DOM Ready时再执行一次
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideCMDB);
    }
    
    // 额外保险：延迟执行确保覆盖所有情况
    setTimeout(hideCMDB, 10);
    setTimeout(hideCMDB, 100);
})();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视图 - 人工智能运维平台</title>
    <link rel="stylesheet" href="libs/fontawesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="视图.css">
    <script src="libs/d3/d3.v7.min.js"></script>
    <style>
        /* 新视图所需的基础样式 */
        .map-container, .visio-container, .room-layout, .line-chart-container {
            position: relative;
            margin-bottom: 20px;
        }

        /* 地图布局样式 */
        .map-layout {
            display: flex;
            gap: 20px;
            height: 500px;
        }

        .map-main {
            flex: 1;
            position: relative;
        }

        .location-info-panel {
            width: 300px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            flex-direction: column;
        }

        .location-info-panel.active {
            display: flex;
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            border-radius: 8px 8px 0 0;
        }

        .info-header h4 {
            margin: 0;
            color: #1e293b;
            font-size: 16px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #e2e8f0;
            color: #1e293b;
        }

        .info-content {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }

        .location-detail {
            margin-bottom: 15px;
        }

        .location-detail:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: bold;
            color: #374151;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #6b7280;
            margin-bottom: 10px;
        }

        .location-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-online {
            background: #dcfce7;
            color: #166534;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status-offline {
            background: #fecaca;
            color: #991b1b;
        }

        /* 地图点样式 */
        .map-location {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .map-location:hover circle:first-child {
            transform: scale(1.2);
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));
        }

        .map-location.selected circle:first-child {
            stroke: #3b82f6;
            stroke-width: 4;
            filter: drop-shadow(0 0 12px rgba(59, 130, 246, 0.8));
        }

        /* 链路样式 */
        .connection-line {
            transition: all 0.3s ease;
        }

        .connection-line.normal {
            stroke: #10b981;
            stroke-width: 3;
        }

        .connection-line.warning {
            stroke: #f59e0b;
            stroke-width: 4;
            stroke-dasharray: 8,4;
        }

        .connection-line.critical {
            stroke: #ef4444;
            stroke-width: 5;
            stroke-dasharray: 4,4;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* 城市标签美化 */
        .city-label {
            font-family: 'Microsoft YaHei', sans-serif;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        /* 状态指示器美化 */
        .status-indicator {
            filter: drop-shadow(0 0 3px rgba(0,0,0,0.3));
        }

        /* 流量标签样式 */
        .traffic-label {
            font-family: 'Microsoft YaHei', sans-serif;
            pointer-events: none;
        }

        /* 地图容器优化 */
        .map-main svg {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* 网络拓扑图样式 */
        .topology-info {
            margin-bottom: 15px;
        }

        .topology-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .topology-stats .stat-item {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            text-align: center;
        }

        .visio-canvas {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            overflow: hidden;
            position: relative;
        }

        #topologyDiagram {
            background: linear-gradient(45deg, #f8fafc 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8fafc 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8fafc 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8fafc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .topology-legend {
            margin-top: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .topology-legend h4 {
            margin: 0 0 10px 0;
            color: #374151;
        }

        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .legend-icon.core-router {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        }

        .legend-icon.access-switch {
            background: linear-gradient(45deg, #10b981, #059669);
        }

        .legend-icon.server {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }

        .legend-icon.firewall {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }

        /* 网络设备样式 */
        .network-device {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .network-device:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .network-device.selected {
            stroke: #3b82f6;
            stroke-width: 3;
        }

        .device-label {
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            fill: #374151;
            pointer-events: none;
        }

        .connection-line {
            stroke: #6b7280;
            stroke-width: 2;
            fill: none;
            transition: all 0.3s ease;
        }

        .connection-line.active {
            stroke: #10b981;
            stroke-width: 3;
            stroke-dasharray: 5,5;
            animation: dash 1s linear infinite;
        }

        .connection-line.inactive {
            stroke: #ef4444;
            stroke-width: 2;
            stroke-dasharray: 3,3;
        }

        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }

        /* 设备状态指示器 */
        .status-indicator {
            r: 4;
        }

        .status-online {
            fill: #10b981;
        }

        .status-warning {
            fill: #f59e0b;
        }

        .status-offline {
            fill: #ef4444;
        }

        /* 导出下拉菜单样式 */
        .export-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            position: relative;
        }

        .dropdown-toggle .fa-caret-down {
            margin-left: 6px;
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .dropdown-toggle:hover .fa-caret-down {
            transform: translateY(1px);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1001;
            min-width: 200px;
            width: auto;
            padding: 10px 0;
            white-space: nowrap;
            margin-top: 8px;
            font-size: 14px;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu button {
            width: 100%;
            padding: 14px 24px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s ease;
            white-space: nowrap;
            overflow: visible;
            display: flex;
            align-items: center;
            line-height: 1.4;
        }

        .dropdown-menu button:hover {
            background-color: #f8fafc;
            color: #1f2937;
        }

        .dropdown-menu button:hover i {
            color: #3b82f6;
        }

        .dropdown-menu button i {
            margin-right: 12px;
            width: 18px;
            min-width: 18px;
            color: #6b7280;
            text-align: center;
            flex-shrink: 0;
            font-size: 14px;
        }

        .route-stats, .visio-controls, .line-overview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item, .line-item {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-label, .line-traffic, .line-latency {
            font-size: 12px;
            color: #64748b;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
        }

        .visio-image {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            background-color: #e2e8f0;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-small:hover {
            background-color: #cbd5e1;
        }

        .line-item {
            text-align: center;
        }

        .line-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .line-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-bottom: 8px;
        }
    </style>
    <style>
        /* 共享样式 */
        .dashboard-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 200px;
            background-color: #000000;
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .sidebar-header {
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid #334155;
        }

        .sidebar-header h2 {
            font-size: 16px;
            margin: 0;
            font-weight: bold;
        }

        .sidebar-group-title {
            font-size: 12px;
            text-transform: uppercase;
            color: #64748b;
            padding: 10px 15px;
            letter-spacing: 1px;
        }

        .sidebar-item {
            width: 69%;
            padding: 12px 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            position: relative;
        }

        .sidebar-item:hover {
            background-color: #334155;
        }

        .sidebar-item.active {
            background-color: #1e293b;
            font-weight: bold;
        }

        .sidebar-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 6px;
            background-color: #3b82f6;
        }

        .sidebar-item i {
            font-size: 16px;
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .sidebar-item span {
            font-size: 14px;
        }

        .sidebar-divider {
            height: 1px;
            background-color: #334155;
            margin: 10px 0;
        }


        /* 主内容区域基础样式 */
        .main-content {
            flex: 1;
            margin-left: 200px;
            background-color: #f5f7fa;
            padding: 20px;
            overflow-y: auto;
            height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 30px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        .modal-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h3 i {
            color: #3b82f6;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            padding: 30px;
        }

        .settings-section, .share-section {
            margin-bottom: 30px;
        }

        .settings-section h4, .share-section h4 {
            color: #374151;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item label {
            display: flex;
            align-items: center;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
        }

        .setting-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .setting-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 5px;
        }

        .setting-desc {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
            margin-left: 25px;
        }

        .share-link-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .share-link-container input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: #f9fafb;
        }

        .btn-copy {
            padding: 10px 15px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: #2563eb;
        }

        .share-desc {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 12px 20px;
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 20px 30px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .btn-primary, .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* 成功提示样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            background: #10b981;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast-content i {
            font-size: 18px;
        }

        /* CSS变量定义 */
        :root {
            --primary-color: #3b82f6;
            --bg-color: #ffffff;
            --text-color: #374151;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --sidebar-bg: #1f2937;
            --sidebar-text: #ffffff;
        }

        /* 深色主题样式 */
        body.dark-theme {
            --bg-color: #2d3748;
            --text-color: #e2e8f0;
            --card-bg: #4a5568;
            --border-color: #718096;
            background-color: var(--bg-color) !important;
            color: var(--text-color) !important;
        }

        body.dark-theme .dashboard-container {
            background: var(--bg-color);
            color: var(--text-color);
        }

        body.dark-theme .main-content {
            background: var(--bg-color);
            color: var(--text-color);
        }

        body.dark-theme .dashboard-card {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .card-header {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .view-controls {
            background: var(--card-bg);
            border-color: var(--border-color);
        }

        body.dark-theme .tab-btn {
            background: var(--card-bg);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        body.dark-theme .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        body.dark-theme .action-btn {
            background: var(--card-bg);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        body.dark-theme .action-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        body.dark-theme .stat-item {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .line-item {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .topology-legend {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .modal-content {
            background: var(--card-bg);
            color: var(--text-color);
        }

        body.dark-theme .modal-header {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        body.dark-theme .modal-footer {
            background: var(--card-bg);
            border-color: var(--border-color);
        }

        body.dark-theme .setting-item label {
            color: var(--text-color);
        }

        body.dark-theme .setting-item select,
        body.dark-theme .setting-item input {
            background: var(--bg-color);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        /* 深色主题下的设备列表和告警信息优化 */
        body.dark-theme .device-list,
        body.dark-theme .alert-list {
            background: #3a4553;
            color: #e2e8f0;
        }

        body.dark-theme .device-item,
        body.dark-theme .alert-item {
            background: #4a5568;
            border-color: #718096;
            color: #e2e8f0;
        }

        body.dark-theme .device-item:hover,
        body.dark-theme .alert-item:hover {
            background: #5a6578;
        }

        body.dark-theme .device-name,
        body.dark-theme .alert-title {
            color: #f7fafc;
            font-weight: 500;
        }

        body.dark-theme .device-status,
        body.dark-theme .alert-time {
            color: #cbd5e0;
        }

        body.dark-theme .device-ip,
        body.dark-theme .alert-desc {
            color: #a0aec0;
        }

        /* 深色主题下的表格优化 */
        body.dark-theme table {
            background: var(--card-bg);
            color: var(--text-color);
        }

        body.dark-theme th {
            background: #3a4553;
            color: #f7fafc;
            border-color: var(--border-color);
        }

        body.dark-theme td {
            background: var(--card-bg);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        body.dark-theme tr:hover td {
            background: #5a6578;
        }

        /* 深色主题下的状态指示器 */
        body.dark-theme .status-online {
            color: #68d391;
        }

        body.dark-theme .status-warning {
            color: #fbd38d;
        }

        body.dark-theme .status-offline {
            color: #fc8181;
        }

        /* 深色主题下的按钮优化 */
        body.dark-theme .btn-small {
            background: #4a5568;
            color: #e2e8f0;
            border-color: #718096;
        }

        body.dark-theme .btn-small:hover {
            background: var(--primary-color);
            color: white;
        }

        /* 深色主题下的输入框优化 */
        body.dark-theme input,
        body.dark-theme select,
        body.dark-theme textarea {
            background: #2d3748;
            color: #e2e8f0;
            border-color: #718096;
        }

        body.dark-theme input:focus,
        body.dark-theme select:focus,
        body.dark-theme textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 配色方案应用 */
        .primary-color {
            color: var(--primary-color);
        }

        .primary-bg {
            background-color: var(--primary-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }

        /* 固定的主色调样式 */
        .tab-btn.active {
            background: #3b82f6 !important;
            color: white !important;
        }

        .action-btn {
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }

        .action-btn:hover {
            background: #3b82f6 !important;
            color: white !important;
        }

        .btn-small:hover {
            background: #3b82f6 !important;
            color: white !important;
        }

        /* 链接和重要文字使用固定蓝色 */
        a, .link {
            color: #3b82f6;
        }

        a:hover, .link:hover {
            color: #2563eb;
        }

        /* 表单焦点状态 */
        input:focus, select:focus, textarea:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

    </style>
</head>
<body>
<div class="dashboard-container">
    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>人工智能运维平台</h2>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-tachometer-alt"></i>
            <span>总览</span>
        </div>
        <div class="sidebar-item nav-view active">
            <i class="fas fa-eye"></i>
            <span>视图</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-bell"></i>
            <span>告警中心</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-server"></i>
            <span>设备管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-network-wired"></i>
            <span>网络拓扑</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-chart-line"></i>
            <span>统计报表</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-tools"></i>
            <span>运维工具</span>
        </div>
        <div class="sidebar-divider"></div>
        <div class="sidebar-group-title">拓展中心</div>
        <div class="sidebar-item">
            <i class="fas fa-layer-group"></i>
            <span>业务管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-globe"></i>
            <span>网络管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-video"></i>
            <span>视频管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-building"></i>
            <span>机房管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-cubes"></i>
            <span>资产管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-user-cog"></i>
            <span>运维管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-database"></i>
            <span>CMDB</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-file-alt"></i>
            <span>日志管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-chart-pie"></i>
            <span>智能预测管理</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-cloud"></i>
            <span>云平台</span>
        </div>
        <div class="sidebar-divider"></div>
        <div class="sidebar-group-title">设置中心</div>
        <div class="sidebar-item">
            <i class="fas fa-cog"></i>
            <span>设置</span>
        </div>
        <div class="sidebar-item">
            <i class="fas fa-plug"></i>
            <span>对接配置</span>
        </div>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
        <div class="header">
            <h1>视图</h1>
            <!-- 用户下拉菜单容器 -->
            <div id="user-dropdown-container"></div>
        </div>

        <!-- 视图控制面板 -->
        <div class="view-controls">
            <div class="view-tabs">
                <button class="tab-btn active" data-view="dashboard">仪表盘视图</button>
                <button class="tab-btn" data-view="route">链路航线图</button>
                <button class="tab-btn" data-view="visio">Visio视图</button>
                <button class="tab-btn" data-view="room">机房仪表盘</button>
                <button class="tab-btn" data-view="line">专线大屏</button>
            </div>
            <div class="view-actions">
                <button class="action-btn" onclick="exportCurrentView()"><i class="fas fa-download"></i> 导出视图</button>
                <button class="action-btn" onclick="shareCurrentView()"><i class="fas fa-share-alt"></i> 共享视图</button>
                <button class="action-btn" onclick="openViewSettings()"><i class="fas fa-cog"></i> 视图设置</button>
            </div>
        </div>

        <!-- 视图内容区域 -->
        <div class="view-content">
            <!-- 仪表盘视图 -->
            <div class="view-panel active" id="dashboard-view">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> 系统概览</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="systemOverviewChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> 资源使用情况</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="resourceUsageChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-server"></i> 活跃设备</h3>
                        </div>
                        <div class="card-body">
                            <ul class="device-list">
                                <!-- 活跃设备将通过JavaScript动态加载 -->
                                <li class="device-item loading">
                                    <i class="fas fa-spinner fa-spin"></i> 正在加载活跃设备...
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> 最近告警</h3>
                        </div>
                        <div class="card-body">
                            <ul class="alert-list">
                                <!-- 最近告警将通过JavaScript动态加载 -->
                                <li class="alert-item loading">
                                    <i class="fas fa-spinner fa-spin"></i> 正在加载最近告警...
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 链路航线图视图 -->
            <div class="view-panel" id="route-view">
                <div class="dashboard-card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-route"></i> 链路航线图</h3>
                    </div>
                    <div class="card-body">
                        <div class="map-container">
                            <div class="map-layout">
                                <div class="map-main">
                                    <svg id="routeMap" width="100%" height="500"></svg>
                                </div>
                                <div class="location-info-panel" id="locationInfoPanel">
                                    <div class="info-header">
                                        <h4><i class="fas fa-map-marker-alt"></i> 地点详细信息</h4>
                                        <button class="close-btn" onclick="closeLocationInfo()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="info-content" id="locationInfoContent">
                                        <p>点击地图上的地点查看详细信息</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="route-stats">
                            <div class="stat-item"><span class="stat-label">总链路数:</span> <span class="stat-value" id="totalLinksCount">0</span></div>
                            <div class="stat-item"><span class="stat-label">正常运行:</span> <span class="stat-value online" id="normalLinksCount">0</span></div>
                            <div class="stat-item"><span class="stat-label">性能下降:</span> <span class="stat-value warning" id="warningLinksCount">0</span></div>
                            <div class="stat-item"><span class="stat-label">故障链路:</span> <span class="stat-value critical" id="criticalLinksCount">0</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visio视图 -->
            <div class="view-panel" id="visio-view">
                <div class="dashboard-card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-project-diagram"></i> Visio网络拓扑图</h3>
                    </div>
                    <div class="card-body">
                        <div class="visio-view-container">
                            <div class="topology-info">
                                <div class="topology-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">核心设备:</span>
                                        <span class="stat-value" id="coreDeviceCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">接入设备:</span>
                                        <span class="stat-value" id="accessDeviceCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">服务器:</span>
                                        <span class="stat-value" id="serverCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">连接数:</span>
                                        <span class="stat-value" id="connectionCount">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="visio-canvas">
                                <svg id="topologyDiagram" width="100%" height="600"></svg>
                            </div>
                        </div>
                        <div class="visio-controls">
                            <button class="btn-small" onclick="zoomIn()"><i class="fas fa-search-plus"></i> 放大</button>
                            <button class="btn-small" onclick="zoomOut()"><i class="fas fa-search-minus"></i> 缩小</button>
                            <button class="btn-small" onclick="resetView()"><i class="fas fa-home"></i> 重置视图</button>
                            <button class="btn-small" onclick="toggleLayout()"><i class="fas fa-sync"></i> 刷新布局</button>
                            <div class="export-dropdown">
                                <button class="btn-small dropdown-toggle" onclick="toggleExportMenu()">
                                    <i class="fas fa-download"></i> 导出 <i class="fas fa-caret-down"></i>
                                </button>
                                <div class="dropdown-menu" id="exportMenu">
                                    <button onclick="exportTopology()"><i class="fas fa-image"></i> 导出拓扑图</button>
                                    <button onclick="exportDeviceList()"><i class="fas fa-list"></i> 导出设备清单</button>
                                    <button onclick="exportNetworkReport()"><i class="fas fa-file-alt"></i> 导出网络报告</button>
                                </div>
                            </div>
                        </div>
                        <div class="topology-legend">
                            <h4>图例</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <div class="legend-icon core-router"></div>
                                    <span>核心路由器</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-icon access-switch"></div>
                                    <span>接入交换机</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-icon server"></div>
                                    <span>服务器</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-icon firewall"></div>
                                    <span>防火墙</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 机房仪表盘视图 -->
            <div class="view-panel" id="room-view">
                <div class="dashboard-grid">
                    <div class="dashboard-card full-width">
                        <div class="card-header">
                            <h3><i class="fas fa-building"></i> 机房状态总览</h3>
                        </div>
                        <div class="card-body">
                            <div class="room-layout">
                                <svg id="roomLayout" width="100%" height="300"></svg>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-temperature-high"></i> 温度监控</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="temperatureChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-tint"></i> 湿度监控</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="humidityChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> 电力状态</h3>
                        </div>
                        <div class="card-body">
                            <ul class="power-list">
                                <li class="power-item"><i class="fas fa-plug"></i> 主电源 <span class="status online"></span></li>
                                <li class="power-item"><i class="fas fa-battery-full"></i> UPS A <span class="status online"></span></li>
                                <li class="power-item"><i class="fas fa-battery-three-quarters"></i> UPS B <span class="status online"></span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-wind"></i> 空调状态</h3>
                        </div>
                        <div class="card-body">
                            <ul class="ac-list">
                                <li class="ac-item"><i class="fas fa-snowflake"></i> 空调1 <span class="status online"></span> 23°C</li>
                                <li class="ac-item"><i class="fas fa-snowflake"></i> 空调2 <span class="status online"></span> 24°C</li>
                                <li class="ac-item"><i class="fas fa-snowflake"></i> 空调3 <span class="status warning"></span> 26°C</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 专线大屏视图 -->
            <div class="view-panel" id="line-view">
                <div class="dashboard-card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-network-wired"></i> 专线状态监控大屏</h3>
                    </div>
                    <div class="card-body">
                        <div class="line-overview">
                            <div class="line-item">
                                <h4>北京-上海</h4>
                                <div class="line-status online"></div>
                                <div class="line-traffic">流量: 456 Mbps</div>
                                <div class="line-latency">延迟: 23 ms</div>
                            </div>
                            <div class="line-item">
                                <h4>上海-广州</h4>
                                <div class="line-status online"></div>
                                <div class="line-traffic">流量: 320 Mbps</div>
                                <div class="line-latency">延迟: 31 ms</div>
                            </div>
                            <div class="line-item">
                                <h4>广州-深圳</h4>
                                <div class="line-status warning"></div>
                                <div class="line-traffic">流量: 780 Mbps</div>
                                <div class="line-latency">延迟: 18 ms</div>
                            </div>
                            <div class="line-item">
                                <h4>北京-成都</h4>
                                <div class="line-status online"></div>
                                <div class="line-traffic">流量: 210 Mbps</div>
                                <div class="line-latency">延迟: 45 ms</div>
                            </div>
                            <div class="line-item">
                                <h4>上海-成都</h4>
                                <div class="line-status critical"></div>
                                <div class="line-traffic">流量: 0 Mbps</div>
                                <div class="line-latency">延迟: 0 ms</div>
                            </div>
                        </div>
                        <div class="line-chart-container">
                            <canvas id="lineTrafficChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 视图设置模态框 -->
<div id="viewSettingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-cog"></i> 视图设置</h3>
            <button class="close-btn" onclick="closeViewSettings()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="settings-section">
                <h4>显示设置</h4>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="autoRefresh" checked> 自动刷新数据
                    </label>
                    <div class="setting-desc">每30秒自动更新视图数据</div>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="showGrid" checked> 显示网格线
                    </label>
                    <div class="setting-desc">在图表中显示辅助网格线</div>
                </div>
            </div>
            
            <div class="settings-section">
                <h4>主题设置</h4>
                <div class="setting-item">
                    <label for="themeSelect">主题模式：</label>
                    <select id="themeSelect">
                        <option value="light">浅色主题</option>
                        <option value="dark">深色主题</option>
                        <option value="auto">跟随系统</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-section">
                <h4>数据设置</h4>
                <div class="setting-item">
                    <label for="refreshInterval">刷新间隔：</label>
                    <select id="refreshInterval">
                        <option value="10">10秒</option>
                        <option value="30" selected>30秒</option>
                        <option value="60">1分钟</option>
                        <option value="300">5分钟</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeViewSettings()">取消</button>
            <button class="btn-primary" onclick="saveViewSettings()">保存设置</button>
        </div>
    </div>
</div>

<!-- 共享视图模态框 -->
<div id="shareViewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-share-alt"></i> 共享视图</h3>
            <button class="close-btn" onclick="closeShareView()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="share-section">
                <h4>分享链接</h4>
                <div class="share-link-container">
                    <input type="text" id="shareLink" readonly value="">
                    <button class="btn-copy" onclick="copyShareLink()">
                        <i class="fas fa-copy"></i> 复制
                    </button>
                </div>
                <div class="share-desc">任何人都可以通过此链接查看当前视图</div>
            </div>
            
            <div class="share-section">
                <h4>分享设置</h4>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="shareWithAuth" checked> 需要登录验证
                    </label>
                    <div class="setting-desc">只有登录用户才能访问</div>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="shareReadOnly" checked> 只读模式
                    </label>
                    <div class="setting-desc">访问者无法修改视图设置</div>
                </div>
                <div class="setting-item">
                    <label for="shareExpiry">有效期：</label>
                    <select id="shareExpiry">
                        <option value="1h">1小时</option>
                        <option value="24h" selected>24小时</option>
                        <option value="7d">7天</option>
                        <option value="30d">30天</option>
                        <option value="never">永不过期</option>
                    </select>
                </div>
            </div>
            
            <div class="share-section">
                <h4>快速分享</h4>
                <div class="share-buttons">
                    <button class="share-btn" onclick="shareToEmail()">
                        <i class="fas fa-envelope"></i> 邮件分享
                    </button>
                </div>
                <div class="share-desc">点击邮件分享按钮，系统将自动打开您的默认邮件客户端</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeShareView()">关闭</button>
            <button class="btn-primary" onclick="generateShareLink()">生成新链接</button>
        </div>
    </div>
</div>

<!-- 导出视图成功提示 -->
<div id="exportSuccessToast" class="toast">
    <div class="toast-content">
        <i class="fas fa-check-circle"></i>
        <span>视图导出成功！</span>
    </div>
</div>

<!-- 引入Chart.js -->
<script src="libs/chartjs/chart.min.js"></script>
<script>
// 检查Chart.js是否加载成功，如果失败则使用备用CDN
if (typeof Chart === 'undefined') {
    console.warn('主CDN加载失败，尝试备用CDN...');
    const script = document.createElement('script');
    script.src = 'libs/chartjs/chart.min.js';
    script.onload = function() {
        console.log('备用CDN加载成功');
    };
    script.onerror = function() {
        console.error('所有CDN都加载失败，加载备用实现');
        // 加载备用实现
        const fallbackScript = document.createElement('script');
        fallbackScript.src = 'chart-fallback.js';
        document.head.appendChild(fallbackScript);
    };
    document.head.appendChild(script);
} else {
    console.log('Chart.js主CDN加载成功');
}
</script>
<script src="chart-fallback.js"></script>
<script src="common.js"></script>
<!-- 引入用户下拉菜单组件 -->
<script src="js/user-dropdown-loader.js"></script>
<script src="视图.js"></script>
</body>
</html>